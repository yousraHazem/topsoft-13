
<head>
  <meta charset="utf-8" />
  <title>jQuery UI Accordion - Default functionality</title>
  <link rel="stylesheet" href="http://code.jquery.com/ui/1.10.3/themes/smoothness/jquery-ui.css" />
  <script src="http://code.jquery.com/jquery-1.9.1.js"></script>
  <script src="http://code.jquery.com/ui/1.10.3/jquery-ui.js"></script>
  <link rel="stylesheet" href="/resources/demos/style.css" />
  <script>
  $(function() {
    $( "#accordion" ).accordion();
  });
  </script>
</head>




<% if current_user %>
<%= link_to("الرجوع إلى قائمة المجموعات", {:action => 'index'}, :class => 'btn btn-link') %>
<% end %>


<h2 class="aligncenter"><%= @group.group_name %></h2>
</br>
</br>
</br>
</br>

<span class="span4 pull-right">
<% if @group.parent %>
 <b> المجموعة الأم: </b>
 <%= link_to(@group.parent.group_name, {:action => 'show', :id => @group.parent.id}, :class => 'action show') %>
 <% end %>
</br>
</br>
</span>
</br>

  <table class="table" id="show">
    <tr>وصف</tr>
    <tr>
    <td style="text-align: center" ><%= @group.description %></td>
  </tr>
  </table>
</br></br>


<span class="span3 pull-left"><%= form_for(:groupuser, :url => {:action => 'getGroupMembers(@group.id)'}) do |f| %>
    <div id="accordion">
      <% @groupmembers = GroupUser.find(:all, :conditions => {:group_id => @group.id}) %>
      <h3>أعضاء المجموعة</h3>
    <div>
    <% @groupmembers.each do |member| %>
      <ul>
        <li><%= link_to(member.user.name, {:controller=>'users', :action=>'show', :id => member.user.id}) %></li>
      </ul>
    <% end %>
    </div>
<% end %>
  </div>
</span>

</br></br></br>



<div>
  <% if current_user %>
    <% if ifMember(@group.id, current_user.id) == false %>
    <%= button_to("اشترك معنا ",{:controller => 'group_users', :action =>'join', :id => @group.id, :user_id => current_user.id}, :class => 'btn span2') %>
    <% end %>
    <% if ifMember(@group.id, current_user.id) == true && isGroupCreator(@group.id, current_user.id) != true %>
    <%= button_to("ترك المجموعة",{:controller => 'group_users', :action =>'leave', :id => @group.id}, :class => 'btn span2') %>               
    <% end %>
    <% if isGroupCreator(@group.id, current_user.id) == true || current_user.isAdmin == true %>
    <%= button_to("أضف مشرف", {:controller => 'group_users',:action =>'index',:id=> @group.id},:class => 'btn span2') %>
    <%= button_to("تعديل", {:action => 'edit', :id => @group.id},:helper => GroupUsersHelper, :class => 'btn span2') %>
    <%= button_to("حذف المجموعة", {:action => 'destroy', :id => @group.id}, :helper => GroupUsersHelper, :confirm => 'هل أنت متأكد؟', :class => 'btn span2') %>
    <% end %>
    <% if ifMember(@group.id, current_user.id) == true &&  @group.level <= 2 %> 
    <%= button_to("إنشاء مجموعة فرعية", {:action =>'new', :parent_id => @group.id}, :class => 'btn span2') %>
    <% end %>
  <% end %>
</br>
</br>


<div>
  <% if current_user %>
  <% if ifMember(params[:id],current_user.id)==true %>
  <%= form_for(:post,  :url => {:controller => 'posts',:action => 'createPost', :id => params[:id], :user_id => current_user.id}) do |f| %>
  <div class="triangle-create">
    <td class="cin"><%= f.text_area (:content),:placeholder =>"أضف تعبيرك ", "cols"=> 40, "rows"=> 3 %></td>
    <%= f.hidden_field :group_id, :value => @group.id%> 
    <%= f.hidden_field :user_id, :value => current_user.id %>
    <%= f.hidden_field :is_group, :value => 'true' %>
    <%= f.hidden_field :name, :value => current_user.username %>
    <span class="pull-left"><button  class="btn btn-info" type="submit">نشر التعبير</button> </span>
  </div>     
  <%end%>
  <%end%>
  <%end%>

  <div id = "allpostsborder">
    <p>
      <% @group.posts.each do |post| %>
      <% if current_user %> 
      <%if isPostCreator(current_user.id,post.id ) == true %>
      <div class="triangle-isosceles">
        <i id="edit" data-container='body' data-placement='top' data-trigger="hover" data-html="true" data-toggle="tooltip" title="انقر تعبيرك للتعديل ">
          <span id="uname" class="under pull-right"><%= post.name %></span><br>
          <span class="pull-left"><%= link_to("x", {:controller => 'posts', :action => 'destroyPost', :group_id => @group.id, :post_id => post.id },:confirm => 'هل أنت متأكد؟') %></span>
          <span id="posteach"><%= best_in_place post, :content, :path => {:controller => 'posts', :action=>'updatePost', :id=>post.id,:group_id => @group.id} %></span><br>
          <i dir="ltr" id="time" class="pull-left"><%= time_ago_in_words(post.created_at)%><i id="time"> ago</i></i></i>
        </p>
    </i>
  </div>
  <%else%>
  <p>
    <div class="triangle-isosceles">
      <span id="uname" class="under pull-right"><%= post.name %></span></br>
      <%= breaking_word_wrap(post.content, :line_width => 8) %><br>
      <span class="pull-left"><i dir="ltr" id="time"><%= time_ago_in_words(post.created_at)%><i id="time"> ago</i></span></i>
    </div>
  </p>
  <%end%>
  <%else%>
  <p>
    <div class="triangle-isosceles">
      <span class="under pull=right"><%= post.name %></i></br>
      <%= breaking_word_wrap(post.content, :line_width => 8) %><br>
      <span class="pull-left"><i dir="ltr" id="time"><%= time_ago_in_words(post.created_at)%><i id="time"> ago</i></span></i>
    </p>
    <%end%>
  </div>
  <%= render :partial => "listcomments", :locals => {:post => post, :position=>0} %>
  <%end%> 
</div>

<% if !current_user %>
</br></br></br></br>
<% end %>
</br></br></br></br></br>
<span class="pull-left"> 
    <footer>
      <p>
        <b>أنشئت في</b>
        <%= @group.created_at %>
      </p>
    </footer>
</span>